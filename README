A Procedural Language in JavaScript powered by V8
=================================================

plv8 is a shared library that provides a PostgreSQL procedural language powered
by V8 JavaScript Engine.  With this program you can write in JavaScript your
function that is callable from SQL.

REQUIREMENT
-----------

plv8 is tested with:

- PG: version 8.4, 9.0, 9.1 and 9.2dev (maybe older are allowed)
- V8: version 3.6.2
- g++: version 4.5.1

Also all tools that PostgreSQL and V8 require to be built are required.

INSTALL
-------

If you use pgxn client, you don't have to worry much.  It does everything.
If you are building plv8 from source, make sure V8 include files are in the
system include directories, or you can pass V8 source path via V8_SRCDIR, and
if so, you'll probably need V8_OUTDIR pointing where libv8 is located.
Run make:

  $ make V8_SRCDIR=/path/to/v8 V8_OUTDIR=/path/to/v8/out/native install

If you prefer to build plv8 statically linking with v8, try V8_STATIC_SNAPSHOT
or V8_STATIC_NOSNAPSHOT.  Consult Makefile for more detail.

Once you installed plv8 into your dabase, create language via

  $ psql -c 'CREATE EXTENSION plv8'
  $ psql -c 'CREATE EXTENSION plls'
  $ psql -c 'CREATE EXTENSION plcoffee'

in 9.1, or in the prior versions

  $ psql -f plv8.sql

to create database objects.

TEST
----

plv8 supports installcheck test.  Make sure set custom_variable_classes = 'plv8'
in your postgresql.conf and

  $ make installcheck

EXAMPLE (JAVASCRIPT)
--------------------

  CREATE OR REPLACE FUNCTION plv8_test(keys text[], vals text[])
  RETURNS text AS $$
    var o = {};
    for(var i=0; i<keys.length; i++){
      o[keys[i]] = vals[i];
    }
    return JSON.stringify(o);
  $$ LANGUAGE plv8 IMMUTABLE STRICT;
  
  SELECT plv8_test(ARRAY['name', 'age'], ARRAY['Tom', '29']);
           plv8_test        
  ---------------------------
   {"name":"Tom","age":"29"}
  (1 row)

EXAMPLE (LIVESCRIPT)
--------------------

  CREATE OR REPLACE FUNCTION plls_test(keys text[], vals text[])
  RETURNS text AS $$
    return JSON.stringify { [key, vals[idx]] for key, idx in keys }
  $$ LANGUAGE plls IMMUTABLE STRICT;
  
  SELECT plls_test(ARRAY['name', 'age'], ARRAY['Tom', '29']);
           plls_test        
  ---------------------------
   {"name":"Tom","age":"29"}
  (1 row)

NOTES
-----
plv8 is hosted at Google Project Hosting
http://code.google.com/p/plv8js/

and distributed by PGXN.  For more detail, see
http://pgxn.org/dist/plv8/doc/plv8.html
